<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thermes & SPA — гид по курортам | Tours Languedoc by Irène</title>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=__gmapsLoaded">
</script>

<style>
  :root{--brand:#0D2B1E;--accent:#C9B886;--ink:#0b1b14;--muted:#6b7b73;--bg:#f8f7f3}
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  header{background:var(--brand);color:#fff;padding:18px} header h1{margin:0;font-weight:600;font-size:18px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .panel{background:#fff;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:14px;margin-bottom:12px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid #e5e1d8;border-radius:12px;padding:8px 10px;cursor:pointer;background:#fff}
  .chip.active{background:var(--brand);border-color:var(--brand);color:#fff}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  select{padding:10px 12px;border-radius:10px;border:1px solid #e5e1d8;background:#fff;width:100%}
  .h2{font-weight:700;margin:6px 0 4px;color:var(--brand);font-size:18px}
  .muted{color:var(--muted)}
  .pill{display:inline-block;padding:6px 10px;border:1px dashed #d9d3c6;border-radius:999px;font-size:12px;color:var(--muted);margin-right:6px}
  img.thumb{width:100%;height:260px;object-fit:cover;border-radius:12px;border:1px solid #eee}
  #map{height:380px;border-radius:12px}
  .desc-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px}
  @media(max-width:900px){.row{grid-template-columns:1fr} .desc-grid{grid-template-columns:1fr}}
  ul.clean{margin:6px 0 0 16px}
  .badge{display:inline-block;font-size:12px;padding:3px 8px;border-radius:999px;background:#eef;border:1px solid #dde;color:#223}
</style>
</head>
<body>
<header><h1>Tours Languedoc by Irène — Thermes & SPA</h1></header>
<main class="wrap">

  <!-- Фильтры -->
  <section class="panel">
    <div class="chips" id="cat">
      <span class="chip active" data-v="medical">Medical</span>
      <span class="chip" data-v="spa">Spa / loisirs</span>
      <span class="chip" data-v="wild">Природные источники</span>
    </div>
    <div class="row" style="margin-top:10px">
      <div>
        <label class="muted">Выберите термы</label>
        <select id="therme"></select>
      </div>
      <div>
        <label class="muted">Метки / специализации</label>
        <div id="tagsFilter" class="chips" style="margin-top:6px"></div>
      </div>
    </div>
  </section>

  <!-- Карта -->
  <section class="panel">
    <div id="map"></div>
  </section>

  <!-- Описание выбранного курорта (расширенное) -->
  <section class="panel">
    <div class="h2" id="title">—</div>
    <div class="muted" id="meta"></div>
    <div class="desc-grid" style="margin-top:10px">
      <div>
        <p id="desc">Выберите курорт, чтобы увидеть подробности.</p>
        <div id="badges" style="margin:8px 0"></div>
        <div style="display:grid;gap:8px;margin-top:6px">
          <div><b>Показания / форматы</b>
            <ul class="clean" id="indications"></ul>
          </div>
          <div><b>Вода</b>
            <ul class="clean" id="water"></ul>
          </div>
          <div><b>Сезон и загрузка</b>
            <ul class="clean" id="season"></ul>
          </div>
          <div><b>Где жить</b>
            <ul class="clean" id="stay"></ul>
          </div>
          <div><b>Идеально для</b>
            <ul class="clean" id="ideal"></ul>
          </div>
          <div><b>Комбинировать с</b>
            <ul class="clean" id="combo"></ul>
          </div>
          <div><b>Сервис Irène</b>
            <ul class="clean" id="service"></ul>
          </div>
        </div>
      </div>
      <div>
        <img id="img" class="thumb" alt="Thermes" src="" style="display:none">
      </div>
    </div>
    <p class="muted" style="margin-top:12px">Примечание: cure thermale conventionnée во Франции длится 18 дней. Я организую авторские 7/14/21 дни под ваши даты и задачи, включая жильё, трансферы и экскурсии.</p>
  </section>
</main>

<script>
// ====== ДАННЫЕ КУРОРТОВ (как у тебя выше, не трогаем) ======
const THERMES = [/* оставь свой массив THERMES из файла */];

// ====== УТИЛИТЫ ======
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const state = {cat:'medical', therme:null, tag:null};

// ====== GOOGLE MAPS ======
let gmap, gmarkers = [], gbounds;
let __mapsReady = false;
function __gmapsLoaded(){ __mapsReady = true; if (window.__initAfterMaps) window.__initAfterMaps(); }

// Фильтры
function fillThermes(){
  const list = THERMES.filter(t=>t.cat===state.cat && (!state.tag || t.tags.includes(state.tag)));
  const sel = $('#therme'); sel.innerHTML='';
  list.forEach(t=>{const o=document.createElement('option');o.value=t.id;o.textContent=`${t.name} — ${t.dept}`;sel.appendChild(o)});
  state.therme = list[0]?.id || null;
}
function fillTags(){
  const set = new Set();
  THERMES.filter(t=>t.cat===state.cat).forEach(t=>t.tags?.forEach(tag=>set.add(tag)));
  const cont = $('#tagsFilter'); cont.innerHTML='';
  const all = document.createElement('span'); all.className='chip'+(!state.tag?' active':''); all.textContent='Все'; all.dataset.v=''; cont.appendChild(all);
  all.addEventListener('click',()=>{state.tag=null; highlightTag(); refreshAll();});
  Array.from(set).sort().forEach(tag=>{
    const sp = document.createElement('span'); sp.className='chip'+(state.tag===tag?' active':''); sp.textContent=tag; sp.dataset.v=tag; cont.appendChild(sp);
    sp.addEventListener('click',()=>{state.tag=tag; highlightTag(); refreshAll();});
  });
}
function highlightTag(){
  $$('#tagsFilter .chip').forEach(c=>c.classList.remove('active'));
  const match = $$('#tagsFilter .chip').find(c=> (state.tag? c.dataset.v===state.tag : c.dataset.v===''));
  if(match) match.classList.add('active');
}

// Описание
function updateDesc(){
  const t = THERMES.find(x=>x.id===state.therme); if(!t) return;
  $('#title').textContent = t.name;
  $('#meta').textContent = `${t.city} • ${t.dept}`;
  $('#desc').textContent = t.desc;
  $('#badges').innerHTML = (t.tags||[]).map(s=>`<span class="badge">${s}</span>`).join(' ');
  fillList('#indications', t.indications);
  fillList('#water', t.water);
  fillList('#season', t.season);
  fillList('#stay', t.stay);
  fillList('#ideal', t.ideal);
  fillList('#combo', t.combo);
  fillList('#service', t.service);
  const img = $('#img'); if(t.img){img.src=t.img; img.style.display='block';} else {img.removeAttribute('src'); img.style.display='none';}
}
function fillList(sel, arr){
  const el = $(sel); el.innerHTML = (arr||[]).map(x=>`<li>${x}</li>`).join('');
}

// ====== КАРТА GOOGLE ======
function initMap(){
  // центр по Occitanie
  gmap = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 43.6, lng: 3.3},
    zoom: 8,
    mapTypeControl: false,
    streetViewControl: false
  });
  refreshMarkers();
}
function clearMarkers(){
  gmarkers.forEach(m=>m.setMap(null));
  gmarkers = [];
}
function refreshMarkers(){
  if(!gmap) return;
  clearMarkers();
  gbounds = new google.maps.LatLngBounds();
  const list = THERMES.filter(t=>t.cat===state.cat && (!state.tag || t.tags.includes(state.tag)));
  list.forEach(t=>{
    const pos = {lat: t.lat, lng: t.lon};
    const marker = new google.maps.Marker({
      position: pos,
      map: gmap,
      title: t.name
    });
    const iw = new google.maps.InfoWindow({
      content: `<div style="font-weight:600">${t.name}</div><div style="color:#666">${t.city} • ${t.dept}</div>`
    });
    marker.addListener('click', ()=>{
      iw.open(gmap, marker);
      state.therme = t.id; $('#therme').value = t.id; updateDesc();
    });
    gmarkers.push(marker);
    gbounds.extend(pos);
  });
  if (list.length){
    gmap.fitBounds(gbounds);
    // небольшой паддинг
    const l = google.maps.ControlPosition;
    gmap.panBy(0,0);
  }
}

// ====== ИНИЦИАЦИЯ ======
function refreshAll(){ fillThermes(); updateDesc(); refreshMarkers(); }

function init(){
  // категории
  $$('#cat .chip').forEach(ch=>ch.addEventListener('click',()=>{
    $$('#cat .chip').forEach(c=>c.classList.remove('active'));
    ch.classList.add('active');
    state.cat = ch.dataset.v; state.tag=null; fillTags(); refreshAll();
  }));
  // выбор курорта
  $('#therme').addEventListener('change', e=>{ state.therme=e.target.value; updateDesc(); });

  fillTags();
  // карта после загрузки API
  initMap();
  refreshAll();
}

// ждём и DOM, и Google API
document.addEventListener('DOMContentLoaded', ()=>{
  window.__initAfterMaps = () => init();
  if (__mapsReady) init();
});
</script>

// ====== УТИЛИТЫ ======
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const state = {cat:'medical', therme:null, tag:null};
let map, markersGroup;

function fillThermes(){
  const list = THERMES.filter(t=>t.cat===state.cat && (!state.tag || t.tags.includes(state.tag)));
  const sel = $('#therme'); sel.innerHTML='';
  list.forEach(t=>{const o=document.createElement('option');o.value=t.id;o.textContent=`${t.name} — ${t.dept}`;sel.appendChild(o)});
  state.therme = list[0]?.id || null;
}

function fillTags(){
  const set = new Set();
  THERMES.filter(t=>t.cat===state.cat).forEach(t=>t.tags?.forEach(tag=>set.add(tag)));
  const cont = $('#tagsFilter'); cont.innerHTML='';
  const all = document.createElement('span'); all.className='chip'+(!state.tag?' active':''); all.textContent='Все'; all.dataset.v=''; cont.appendChild(all);
  all.addEventListener('click',()=>{state.tag=null; highlightTag(); refreshAll();});
  Array.from(set).sort().forEach(tag=>{
    const sp = document.createElement('span'); sp.className='chip'+(state.tag===tag?' active':''); sp.textContent=tag; sp.dataset.v=tag; cont.appendChild(sp);
    sp.addEventListener('click',()=>{state.tag=tag; highlightTag(); refreshAll();});
  });
}
function highlightTag(){
  $$('#tagsFilter .chip').forEach(c=>c.classList.remove('active'));
  const match = $$('#tagsFilter .chip').find(c=> (state.tag? c.dataset.v===state.tag : c.dataset.v===''));
  if(match) match.classList.add('active');
}

function updateDesc(){
  const t = THERMES.find(x=>x.id===state.therme); if(!t) return;
  $('#title').textContent = t.name;
  $('#meta').textContent = `${t.city} • ${t.dept}`;
  $('#desc').textContent = t.desc;
  const badges = (t.tags||[]).map(s=>`<span class="badge">${s}</span>`).join(' ');
  $('#badges').innerHTML = badges;
  fillList('#indications', t.indications);
  fillList('#water', t.water);
  fillList('#season', t.season);
  fillList('#stay', t.stay);
  fillList('#ideal', t.ideal);
  fillList('#combo', t.combo);
  fillList('#service', t.service);
  const img = $('#img'); if(t.img){img.src=t.img; img.style.display='block';} else {img.removeAttribute('src'); img.style.display='none';}
}
function fillList(sel, arr){
  const el = $(sel); el.innerHTML = (arr||[]).map(x=>`<li>${x}</li>`).join('');
}

// ====== КАРТА ======
function initMap(){
  map = L.map('map');
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18, attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
  markersGroup = L.featureGroup().addTo(map);
}
function refreshMarkers(){
  markersGroup.clearLayers();
  const list = THERMES.filter(t=>t.cat===state.cat && (!state.tag || t.tags.includes(state.tag)));
  list.forEach(t=>{
    const m = L.marker([t.lat,t.lon]).bindPopup(`<b>${t.name}</b><br>${t.city} • ${t.dept}`);
    m.on('click',()=>{ state.therme=t.id; $('#therme').value=t.id; updateDesc(); });
    markersGroup.addLayer(m);
  });
  if(list.length){ map.fitBounds(markersGroup.getBounds().pad(0.2)); }
}

// ====== ИНИЦИАЦИЯ И СОБЫТИЯ ======
function refreshAll(){
  fillThermes(); updateDesc(); refreshMarkers();
}

function init(){
  $$('#cat .chip').forEach(ch=>ch.addEventListener('click',()=>{
    $$('#cat .chip').forEach(c=>c.classList.remove('active'));
    ch.classList.add('active');
    state.cat = ch.dataset.v; state.tag=null; fillTags(); refreshAll();
  }));
  $('#therme').addEventListener('change', e=>{ state.therme=e.target.value; updateDesc(); });
  initMap(); fillTags(); refreshAll();
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>

